# 工作流编辑器使用指南 🚀

欢迎使用增强版工作流编辑器！本指南将帮助你快速上手。

---

## 📖 目录

1. [快速开始](#快速开始)
2. [节点介绍](#节点介绍)
3. [使用教程](#使用教程)
4. [常见场景](#常见场景)
5. [最佳实践](#最佳实践)
6. [常见问题](#常见问题)

---

## 🚀 快速开始

### 第一步：打开工作流编辑器

1. 登录系统
2. 点击侧边栏的"工作流编辑器"
3. 或在智能体页面点击"工作流编辑器"按钮

### 第二步：创建你的第一个工作流

```
1. 从左侧节点库拖拽"ChatModel"到画布
2. 点击节点，在右侧配置面板进行配置
3. 保存工作流
4. 创建Agent
```

### 第三步：测试工作流

在聊天页面选择刚创建的Agent进行测试。

---

## 🎯 节点介绍

### 核心节点（4个）

#### 🔵 ChatModel - 大语言模型
**用途：** 文本生成、对话、理解、分析

**配置步骤：**
1. 选择API配置（或使用默认）
2. 选择AI平台（OpenRouter推荐）
3. 搜索并选择模型
4. 调整Temperature（创造性 vs 精确性）
5. 设置Max Tokens（响应长度）

**推荐配置：**
- 创造性任务：Temperature 1.0-1.5
- 精确任务：Temperature 0.1-0.5
- 一般对话：Temperature 0.7

#### 🟢 Tool - 工具调用
**用途：** 扩展AI能力，执行特定任务

**内置工具：**
- 🔍 网页搜索 - 获取实时信息
- 🧮 计算器 - 数学计算
- 💻 代码解释器 - 执行代码
- 📁 文件读取 - 读取文件
- 🎨 图片生成 - AI绘图
- 🕷️ 网页抓取 - 抓取网页
- 🗄️ 数据库查询 - 查询数据
- 🌐 API调用 - 调用外部API

**配置步骤：**
1. 从下拉框选择内置工具
2. 或输入自定义工具名称
3. 编辑工具描述
4. 配置工具参数（JSON格式）

#### 🟣 Lambda - 自定义函数
**用途：** 自定义逻辑、数据处理、格式转换

**代码模板：**
1. **空模板** - 基础结构
2. **文本处理** - 大小写转换、字数统计
3. **JSON解析** - 安全解析和字段提取
4. **数据过滤** - 过滤和排序
5. **API响应格式化** - 标准化响应
6. **条件判断** - 多条件逻辑

**配置步骤：**
1. 选择代码模板（可选）
2. 输入函数名称
3. 编写或修改代码
4. 使用 `function process(input)` 作为入口

**代码示例：**
```javascript
function process(input) {
  // 你的处理逻辑
  const result = input.text.toUpperCase();
  return { result: result };
}
```

#### 🟠 Retriever - 检索器
**用途：** 知识库检索、RAG应用

**配置步骤：**
1. 选择检索类型（向量/关键词/混合）
2. 设置Top K（返回结果数量）
3. 配置数据源

---

### 逻辑控制节点（3个）

#### 🟡 Condition - 条件判断
**用途：** 流程分支、条件路由

**示例：**
```javascript
// 条件表达式
input.score > 0.8

// 或选择条件类型
- 等于
- 大于
- 小于
- 包含
```

#### 🔴 Loop - 循环
**用途：** 批量处理、重复任务

**循环类型：**
- For循环 - 固定次数
- While循环 - 条件循环
- ForEach循环 - 遍历数组

#### 🟤 Switch - 多路分支
**用途：** 多条件路由、状态机

**配置示例：**
```json
{
  "success": "path1",
  "error": "path2",
  "pending": "path3"
}
```

---

### 数据处理节点（4个）

#### 🔵 Transform - 数据转换
**转换类型：**
- 映射 (map)
- 归约 (reduce)
- 过滤 (filter)
- 排序 (sort)

#### 🟢 Merge - 数据合并
**合并策略：**
- 连接 (concat)
- 合并 (merge)
- 覆盖 (override)
- 深度合并 (deep_merge)

#### 🟣 Filter - 数据过滤
**示例：**
```javascript
(item) => item.value > 0
```

#### 🟠 Template - 模板渲染
**语法：** `{{variable}}`

**示例：**
```
Hello {{name}}, your score is {{score}}
```

---

### 集成节点（3个）

#### 🔴 HTTP Request - HTTP请求
**支持方法：** GET, POST, PUT, DELETE, PATCH

**配置示例：**
```json
{
  "method": "POST",
  "url": "https://api.example.com/data",
  "headers": {
    "Content-Type": "application/json"
  },
  "body": {
    "key": "value"
  }
}
```

#### 🟣 Webhook - Webhook触发器
**认证方式：**
- 无
- Token
- Basic Auth
- API Key

#### ⚫ Delay - 延迟执行
**用途：** 流程控制、限流

---

## 📚 使用教程

### 教程1：创建简单问答Agent

**目标：** 创建一个能回答问题的AI助手

**步骤：**

1. **添加ChatModel节点**
   ```
   - 拖拽"ChatModel"到画布
   - 配置：
     * API配置：使用默认
     * 平台：OpenRouter
     * 模型：claude-3.5-sonnet
     * Temperature：0.7
     * Max Tokens：2000
   ```

2. **保存工作流**
   ```
   - 点击"保存工作流"
   - 输入名称："简单问答"
   ```

3. **创建Agent**
   ```
   - 点击"创建Agent"
   - 填写信息
   - 提交
   ```

4. **测试**
   ```
   - 前往聊天页面
   - 选择刚创建的Agent
   - 开始对话
   ```

---

### 教程2：创建带工具的智能助手

**目标：** 创建一个能搜索网络的AI助手

**步骤：**

1. **添加ChatModel节点**
   ```
   节点1: 理解用户问题
   - 模型：claude-3.5-sonnet
   - Temperature：0.7
   ```

2. **添加Tool节点**
   ```
   节点2: 网页搜索
   - 选择工具：网页搜索
   - 工具名称：web_search
   - 参数：{"max_results": 5}
   ```

3. **添加第二个ChatModel节点**
   ```
   节点3: 综合回答
   - 模型：claude-3.5-sonnet
   - Temperature：0.8
   ```

4. **连接节点**
   ```
   节点1 → 节点2 → 节点3
   ```

5. **保存并创建Agent**

---

### 教程3：创建数据处理工作流

**目标：** 从API获取数据并处理

**步骤：**

1. **添加HTTP Request节点**
   ```
   节点1: 获取数据
   - 方法：GET
   - URL：https://api.example.com/data
   ```

2. **添加Lambda节点**
   ```
   节点2: 数据清洗
   - 选择模板：数据过滤
   - 修改代码以适应你的需求
   ```

3. **添加Filter节点**
   ```
   节点3: 过滤无效数据
   - 条件：(item) => item.valid === true
   ```

4. **添加Transform节点**
   ```
   节点4: 数据转换
   - 类型：map
   - 函数：(item) => ({ id: item.id, name: item.name })
   ```

5. **连接并保存**
   ```
   节点1 → 节点2 → 节点3 → 节点4
   ```

---

## 🎯 常见场景

### 场景1：智能客服

```
Start 
  → ChatModel (理解问题)
  → Condition (判断问题类型)
    ├─ 简单问题 → Template (生成回复)
    └─ 复杂问题 → Tool (搜索) → ChatModel (综合回答)
  → End
```

**适用于：** 客服机器人、FAQ系统

---

### 场景2：内容生成

```
Start 
  → ChatModel (生成初稿)
  → Lambda (格式化)
  → Template (应用模板)
  → End
```

**适用于：** 文章生成、邮件撰写

---

### 场景3：数据分析

```
Start 
  → HTTP Request (获取数据)
  → Lambda (数据清洗)
  → Filter (过滤)
  → Transform (转换)
  → ChatModel (分析)
  → Template (生成报告)
  → End
```

**适用于：** 数据报告、趋势分析

---

### 场景4：API集成

```
Start 
  → Webhook (接收请求)
  → Lambda (参数验证)
  → Switch (路由)
    ├─ 路径A → HTTP Request (API A)
    ├─ 路径B → HTTP Request (API B)
    └─ 默认 → Template (错误响应)
  → End
```

**适用于：** API网关、服务编排

---

### 场景5：批量处理

```
Start 
  → HTTP Request (获取列表)
  → Loop (遍历)
    → Lambda (处理单项)
    → ChatModel (AI处理)
  → Merge (合并结果)
  → End
```

**适用于：** 批量翻译、批量分类

---

## 💡 最佳实践

### 1. 节点命名
✅ **好的命名：**
- "理解用户问题"
- "搜索相关信息"
- "生成最终回答"

❌ **不好的命名：**
- "节点1"
- "ChatModel"
- "处理"

### 2. 工作流设计
✅ **推荐：**
- 保持流程简洁（5-10个节点）
- 逻辑清晰，易于理解
- 合理使用条件和循环

❌ **避免：**
- 过度复杂的流程
- 深层嵌套
- 循环依赖

### 3. ChatModel配置
✅ **推荐：**
- 根据任务选择合适的模型
- 创造性任务用高Temperature
- 精确任务用低Temperature

❌ **避免：**
- 所有任务都用同一配置
- Temperature设置极端值

### 4. Lambda代码
✅ **推荐：**
- 从模板开始
- 保持函数简洁
- 添加错误处理
- 使用注释

❌ **避免：**
- 复杂的逻辑
- 缺少错误处理
- 没有注释

### 5. 工具使用
✅ **推荐：**
- 优先使用内置工具
- 清晰的工具描述
- 合理的参数配置

❌ **避免：**
- 重复造轮子
- 模糊的描述
- 缺少参数

---

## ❓ 常见问题

### Q1: 如何选择合适的模型？

**A:** 根据任务类型选择：
- **对话类：** Claude 3.5 Sonnet
- **代码类：** GPT-4 Turbo
- **创作类：** Claude 3 Opus
- **快速响应：** GPT-3.5 Turbo

### Q2: Temperature应该设置多少？

**A:** 根据需求：
- **0.1-0.3：** 事实性问答、数据分析
- **0.5-0.7：** 一般对话、翻译
- **0.8-1.2：** 创意写作、头脑风暴
- **1.3-2.0：** 极度创造性任务

### Q3: 工作流可以有多少个节点？

**A:** 理论上无限制，但建议：
- **简单工作流：** 3-5个节点
- **中等工作流：** 6-10个节点
- **复杂工作流：** 11-20个节点
- **超过20个：** 考虑拆分

### Q4: Lambda节点可以做什么？

**A:** 几乎任何JavaScript能做的：
- 数据转换和格式化
- 条件判断和逻辑处理
- 字符串操作
- 数学计算
- JSON解析和生成

**限制：**
- 不能访问文件系统
- 不能发起网络请求（用HTTP节点）
- 不能执行长时间任务

### Q5: 如何调试工作流？

**A:** 目前建议：
1. 从简单开始，逐步添加节点
2. 使用有意义的节点名称
3. 在Lambda中添加日志输出
4. 创建测试Agent进行测试
5. 查看聊天记录中的响应

### Q6: 工作流可以保存吗？

**A:** 可以！
- **本地保存：** 自动保存到浏览器
- **导出：** 导出为JSON文件
- **导入：** 从JSON文件导入
- **创建Agent：** 保存为可用的Agent

### Q7: 如何分享工作流？

**A:** 两种方式：
1. **导出JSON文件** → 分享文件 → 他人导入
2. **创建公开Agent** → 设置为公开 → 他人可查看使用

### Q8: 内置工具如何工作？

**A:** 内置工具是预定义的功能：
- 选择工具后自动配置
- 可以修改参数
- 也可以创建自定义工具

### Q9: 可以在工作流中调用外部API吗？

**A:** 可以！使用HTTP Request节点：
1. 设置请求方法
2. 配置URL
3. 添加请求头和请求体
4. 连接到其他节点处理响应

### Q10: 工作流执行失败怎么办？

**A:** 检查以下几点：
1. 节点配置是否正确
2. API配置是否有效
3. 模型是否可用
4. 节点连接是否正确
5. Lambda代码是否有错误

---

## 📞 获取帮助

### 文档资源
- 📖 **完整功能文档：** `工作流编辑器增强功能文档.md`
- 📋 **快速参考：** `工作流节点快速参考.md`
- 📊 **更新对比：** `工作流更新对比.md`
- 📝 **更新总结：** `工作流增强更新总结.md`

### 学习路径
1. 阅读本使用指南
2. 跟随教程创建第一个工作流
3. 尝试常见场景示例
4. 查看快速参考
5. 阅读完整功能文档

### 技术支持
- 💬 加入社区讨论
- 📧 提交Issue
- 🎓 观看视频教程（即将推出）

---

## 🎉 开始创建吧！

现在你已经掌握了工作流编辑器的使用方法，开始创建你的第一个AI工作流吧！

**记住：**
- 从简单开始
- 逐步添加功能
- 多多实验
- 享受创造的乐趣！

祝你使用愉快！🚀

