# 变量和条件快速参考卡 🎯

## 🎨 新增节点

### Set Variable（设置变量）
```
配置：
  ├─ 变量名称: user_score
  ├─ 作用域: 工作流变量/局部变量
  └─ 值来源:
      ├─ 静态值: "Hello" 或 123
      ├─ 输入数据: input.response.data
      └─ 表达式: input.count * 2 + 10
```

### Get Variable（获取变量）
```
配置：
  ├─ 变量名称: user_score
  ├─ 默认值: 0 (可选)
  └─ 输出字段名: value
```

### If-Else（条件分支）
```
条件类型：
  ├─ 表达式: input.score > 80
  ├─ 比较: 左值 运算符 右值
  ├─ 存在性: 检查字段是否存在
  └─ 类型: 检查数据类型

支持 Else If：
  ├─ If: score > 90 → 优秀
  ├─ Else If: score > 80 → 良好
  ├─ Else If: score > 60 → 及格
  └─ Else: → 不及格
```

---

## 📝 变量命名规则

✅ **正确：**
- `user_name`
- `api_response`
- `score_threshold`
- `is_authenticated`

❌ **错误：**
- `123user` (不能以数字开头)
- `user-name` (不能用连字符)
- `用户名` (不能用中文)

---

## 🔤 变量引用语法

### 在表达式中
```javascript
$user_score > 80
$user_name == "admin"
input.value + $threshold
```

### 在模板中
```
Hello {{$user_name}}, your score is {{$user_score}}
```

---

## ⚖️ 条件运算符

### 比较运算符
```
>   大于
<   小于
==  等于
!=  不等于
>=  大于等于
<=  小于等于
```

### 逻辑运算符
```
&&  且（and）
||  或（or）
!   非（not）
```

### 字符串运算符
```
包含 (contains)
开始于 (starts_with)
结束于 (ends_with)
```

---

## 🎯 常用模式

### 模式1：保存并使用数据
```
HTTP Request
  ↓
Set Variable (保存响应)
  变量: api_response
  值来源: 输入数据
  路径: input.response
  ↓
Get Variable (获取响应)
  变量: api_response
  ↓
Lambda (处理数据)
```

### 模式2：条件分支
```
ChatModel
  ↓
If-Else (判断意图)
  条件: input.intent == "query"
  ├─ True → 查询处理
  └─ Else → 其他处理
```

### 模式3：多级判断
```
Get Variable (获取分数)
  ↓
If-Else
  If: $score > 90 → A等级
  Else If: $score > 80 → B等级
  Else If: $score > 70 → C等级
  Else If: $score > 60 → D等级
  Else: → F等级
```

### 模式4：数据验证
```
If-Else (检查邮箱存在)
  条件类型: 存在性检查
  路径: input.user.email
  ├─ True → 继续
  └─ Else → 返回错误
```

---

## 🎨 变量管理面板

### 打开方式
点击顶部工具栏的 **"变量"** 按钮

### 功能
- ➕ 添加全局变量
- ✏️ 编辑变量值
- 🗑️ 删除变量
- 📊 查看统计信息

### 统计信息
- 全局变量数量
- Set Variable 节点数量
- Get Variable 节点数量
- If-Else 节点数量

---

## 💡 快速提示

### 变量作用域
| 类型 | 范围 | 使用场景 |
|------|------|---------|
| 工作流变量 | 全局 | 共享数据、配置参数 |
| 局部变量 | 当前分支 | 临时数据、中间结果 |

### 条件类型选择
| 场景 | 推荐类型 |
|------|---------|
| 简单比较 | 比较 |
| 复杂逻辑 | 表达式 |
| 检查字段 | 存在性 |
| 验证类型 | 类型 |

### Else If 使用建议
| 分支数 | 建议 |
|--------|------|
| 2-3个 | If-Else |
| 4-5个 | If-Else + Else If |
| 6-10个 | Switch节点 |
| 10+个 | 重构逻辑 |

---

## 🔧 调试技巧

### 1. 查看变量值
```
Get Variable
  ↓
Lambda (输出日志)
  code: |
    console.log('变量值:', input.value);
    return input;
```

### 2. 测试条件
```
// 简化条件
从: (score > 90 || bonus > 10) && verified == true
到: score > 90  // 先测试单个条件
```

### 3. 使用默认值
```
Get Variable
  变量名称: user_score
  默认值: 0  // 避免undefined错误
```

---

## 📋 检查清单

### 创建变量前
- [ ] 变量名符合命名规则
- [ ] 确定变量作用域
- [ ] 考虑默认值

### 使用条件前
- [ ] 条件表达式正确
- [ ] 考虑所有分支
- [ ] 添加Else处理
- [ ] 测试边界情况

### 工作流完成后
- [ ] 删除未使用的变量
- [ ] 检查变量引用
- [ ] 验证条件逻辑
- [ ] 测试所有分支

---

## 🚀 快速示例

### 示例1：用户认证
```javascript
// If-Else条件
input.user.role == "admin" && input.user.verified == true
```

### 示例2：分数评级
```javascript
// 多级判断
If: $score >= 90
Else If: $score >= 80
Else If: $score >= 70
Else If: $score >= 60
Else: 不及格
```

### 示例3：动态阈值
```javascript
// Set Variable 表达式
input.is_vip ? 50 : 100
```

### 示例4：数据验证
```javascript
// 组合条件
input.email && input.email.includes("@") && input.age >= 18
```

---

## 🎯 记住这些

1. **变量名**：字母、数字、下划线，不以数字开头
2. **引用变量**：使用 `$变量名`
3. **作用域**：优先使用工作流变量（全局）
4. **条件**：简单用比较，复杂用表达式
5. **Else If**：适度使用，不超过5个
6. **默认值**：Get Variable 设置默认值避免错误
7. **调试**：使用Lambda输出日志
8. **面板**：点击"变量"按钮管理变量

---

**需要详细文档？** 查看 `变量和条件功能文档.md`

**需要更多示例？** 查看文档中的"使用教程"和"常见场景"部分

