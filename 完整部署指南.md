# å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

1. [å¼€å‘ç¯å¢ƒéƒ¨ç½²](#å¼€å‘ç¯å¢ƒéƒ¨ç½²)
2. [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)
3. [Dockeréƒ¨ç½²](#dockeréƒ¨ç½²)
4. [äº‘æœåŠ¡å™¨éƒ¨ç½²](#äº‘æœåŠ¡å™¨éƒ¨ç½²)
5. [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
6. [ç›‘æ§å’Œç»´æŠ¤](#ç›‘æ§å’Œç»´æŠ¤)

---

## å¼€å‘ç¯å¢ƒéƒ¨ç½²

### ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: macOS / Linux / Windows (WSL2)
- **Go**: 1.21+
- **Node.js**: 18+
- **MySQL**: 8.0+
- **å†…å­˜**: è‡³å°‘ 4GB
- **ç£ç›˜**: è‡³å°‘ 10GB å¯ç”¨ç©ºé—´

### æ­¥éª¤ 1: å®‰è£…ä¾èµ–

#### macOS
```bash
# å®‰è£… Homebrew (å¦‚æœæœªå®‰è£…)
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# å®‰è£…ä¾èµ–
brew install go node mysql

# å¯åŠ¨ MySQL
brew services start mysql

# è®¾ç½® MySQL root å¯†ç 
mysql_secure_installation
```

#### Ubuntu/Debian
```bash
# æ›´æ–°åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£… Go
wget https://go.dev/dl/go1.21.5.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.21.5.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc

# å®‰è£… Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# å®‰è£… MySQL
sudo apt install -y mysql-server
sudo systemctl start mysql
sudo mysql_secure_installation
```

### æ­¥éª¤ 2: å…‹éš†é¡¹ç›®

```bash
cd /Users/derrick/Documents/code/project/ai_chat
```

### æ­¥éª¤ 3: é…ç½®æ•°æ®åº“

```bash
# ç™»å½• MySQL
mysql -u root -p

# æ‰§è¡Œä»¥ä¸‹ SQL
CREATE DATABASE ai_chat CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'ai_chat_user'@'localhost' IDENTIFIED BY 'your_secure_password';
GRANT ALL PRIVILEGES ON ai_chat.* TO 'ai_chat_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### æ­¥éª¤ 4: é…ç½®åç«¯

```bash
cd backend

# åˆ›å»º .env æ–‡ä»¶
cat > .env << 'EOF'
SERVER_PORT=8080
GIN_MODE=debug
DB_HOST=localhost
DB_PORT=3306
DB_USER=ai_chat_user
DB_PASSWORD=your_secure_password
DB_NAME=ai_chat
JWT_SECRET=$(openssl rand -base64 32)
JWT_EXPIRE_HOURS=24
CORS_ORIGINS=http://localhost:3000
OPENROUTER_API_URL=https://openrouter.ai/api/v1
EOF

# å®‰è£… Go ä¾èµ–
go mod download

# éªŒè¯é…ç½®
go run main.go
```

### æ­¥éª¤ 5: é…ç½®å‰ç«¯

```bash
cd ../frontend

# åˆ›å»º .env æ–‡ä»¶
echo "REACT_APP_API_URL=http://localhost:8080/api" > .env

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm start
```

### æ­¥éª¤ 6: éªŒè¯éƒ¨ç½²

1. åç«¯å¥åº·æ£€æŸ¥: http://localhost:8080/health
2. å‰ç«¯è®¿é—®: http://localhost:3000
3. æ³¨å†Œæµ‹è¯•è´¦æˆ·
4. åˆ›å»ºAPIé…ç½®
5. åˆ›å»ºæ™ºèƒ½ä½“
6. å¼€å§‹å¯¹è¯

---

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### ç³»ç»Ÿè¦æ±‚

- **CPU**: 2æ ¸+
- **å†…å­˜**: 4GB+
- **ç£ç›˜**: 50GB+ SSD
- **å¸¦å®½**: 10Mbps+

### æ­¥éª¤ 1: æœåŠ¡å™¨å‡†å¤‡

```bash
# æ›´æ–°ç³»ç»Ÿ
sudo apt update && sudo apt upgrade -y

# å®‰è£…å¿…è¦å·¥å…·
sudo apt install -y git curl wget vim nginx certbot python3-certbot-nginx

# é…ç½®é˜²ç«å¢™
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
sudo ufw enable
```

### æ­¥éª¤ 2: å®‰è£…è¿è¡Œæ—¶

```bash
# å®‰è£… Go
wget https://go.dev/dl/go1.21.5.linux-amd64.tar.gz
sudo tar -C /usr/local -xzf go1.21.5.linux-amd64.tar.gz
echo 'export PATH=$PATH:/usr/local/go/bin' >> ~/.bashrc
source ~/.bashrc

# å®‰è£… Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# å®‰è£… MySQL
sudo apt install -y mysql-server
sudo systemctl enable mysql
sudo systemctl start mysql
```

### æ­¥éª¤ 3: é…ç½® MySQL

```bash
# å®‰å…¨é…ç½®
sudo mysql_secure_installation

# åˆ›å»ºæ•°æ®åº“å’Œç”¨æˆ·
sudo mysql << EOF
CREATE DATABASE ai_chat CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'ai_chat_user'@'localhost' IDENTIFIED BY 'strong_password_here';
GRANT ALL PRIVILEGES ON ai_chat.* TO 'ai_chat_user'@'localhost';
FLUSH PRIVILEGES;
EOF
```

### æ­¥éª¤ 4: éƒ¨ç½²åç«¯

```bash
# åˆ›å»ºåº”ç”¨ç›®å½•
sudo mkdir -p /var/www/ai-chat
sudo chown $USER:$USER /var/www/ai-chat

# å…‹éš†ä»£ç 
cd /var/www/ai-chat
git clone <your-repo-url> .

# é…ç½®ç¯å¢ƒå˜é‡
cd backend
cp .env.example .env
vim .env  # ç¼–è¾‘é…ç½®

# æ„å»ºåº”ç”¨
go build -o ai-chat-backend main.go

# åˆ›å»º systemd æœåŠ¡
sudo tee /etc/systemd/system/ai-chat-backend.service > /dev/null << 'EOF'
[Unit]
Description=AI Chat Backend Service
After=network.target mysql.service

[Service]
Type=simple
User=www-data
WorkingDirectory=/var/www/ai-chat/backend
ExecStart=/var/www/ai-chat/backend/ai-chat-backend
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl enable ai-chat-backend
sudo systemctl start ai-chat-backend
sudo systemctl status ai-chat-backend
```

### æ­¥éª¤ 5: éƒ¨ç½²å‰ç«¯

```bash
cd /var/www/ai-chat/frontend

# é…ç½®ç¯å¢ƒå˜é‡
echo "REACT_APP_API_URL=https://your-domain.com/api" > .env

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm install
npm run build

# é…ç½® Nginx
sudo tee /etc/nginx/sites-available/ai-chat > /dev/null << 'EOF'
server {
    listen 80;
    server_name your-domain.com;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /var/www/ai-chat/frontend/build;
        try_files $uri $uri/ /index.html;
        
        # ç¼“å­˜é…ç½®
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # åç«¯ API
    location /api {
        proxy_pass http://localhost:8080;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    # å¥åº·æ£€æŸ¥
    location /health {
        proxy_pass http://localhost:8080;
    }
}
EOF

# å¯ç”¨ç«™ç‚¹
sudo ln -s /etc/nginx/sites-available/ai-chat /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### æ­¥éª¤ 6: é…ç½® HTTPS

```bash
# ä½¿ç”¨ Let's Encrypt è·å–å…è´¹ SSL è¯ä¹¦
sudo certbot --nginx -d your-domain.com

# è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run
```

### æ­¥éª¤ 7: é…ç½®å¤‡ä»½

```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
sudo tee /usr/local/bin/backup-ai-chat.sh > /dev/null << 'EOF'
#!/bin/bash
BACKUP_DIR="/var/backups/ai-chat"
DATE=$(date +%Y%m%d_%H%M%S)

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
mysqldump -u ai_chat_user -p'your_password' ai_chat | gzip > $BACKUP_DIR/db_$DATE.sql.gz

# å¤‡ä»½åº”ç”¨ä»£ç 
tar -czf $BACKUP_DIR/app_$DATE.tar.gz /var/www/ai-chat

# åˆ é™¤30å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.gz" -mtime +30 -delete

echo "Backup completed: $DATE"
EOF

sudo chmod +x /usr/local/bin/backup-ai-chat.sh

# æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
(crontab -l 2>/dev/null; echo "0 2 * * * /usr/local/bin/backup-ai-chat.sh") | crontab -
```

---

## Docker éƒ¨ç½²

### ä½¿ç”¨ Docker Compose

```bash
# ç¡®ä¿å·²å®‰è£… Docker å’Œ Docker Compose
docker --version
docker-compose --version

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# åœæ­¢æœåŠ¡
docker-compose down

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹è¿è¡ŒçŠ¶æ€
docker-compose ps
```

### å•ç‹¬æ„å»ºé•œåƒ

```bash
# æ„å»ºåç«¯é•œåƒ
cd backend
docker build -t ai-chat-backend:latest .

# æ„å»ºå‰ç«¯é•œåƒ
cd ../frontend
docker build -t ai-chat-frontend:latest .

# è¿è¡Œå®¹å™¨
docker run -d -p 8080:8080 --name backend ai-chat-backend:latest
docker run -d -p 3000:80 --name frontend ai-chat-frontend:latest
```

---

## äº‘æœåŠ¡å™¨éƒ¨ç½²

### AWS éƒ¨ç½²

#### 1. åˆ›å»º EC2 å®ä¾‹

- é€‰æ‹© Ubuntu 22.04 LTS
- å®ä¾‹ç±»å‹: t3.medium (2vCPU, 4GB RAM)
- å­˜å‚¨: 30GB gp3
- å®‰å…¨ç»„: å¼€æ”¾ 22, 80, 443 ç«¯å£

#### 2. é…ç½® RDS MySQL

- å¼•æ“: MySQL 8.0
- å®ä¾‹ç±»å‹: db.t3.micro
- å­˜å‚¨: 20GB
- å¯ç”¨è‡ªåŠ¨å¤‡ä»½

#### 3. éƒ¨ç½²åº”ç”¨

```bash
# SSH è¿æ¥åˆ° EC2
ssh -i your-key.pem ubuntu@your-ec2-ip

# æŒ‰ç…§ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ­¥éª¤æ“ä½œ
# ä¿®æ”¹æ•°æ®åº“é…ç½®ä¸º RDS åœ°å€
```

### é˜¿é‡Œäº‘éƒ¨ç½²

#### 1. åˆ›å»º ECS å®ä¾‹

- é•œåƒ: Ubuntu 22.04
- è§„æ ¼: ecs.t6-c1m2.large
- å­˜å‚¨: 40GB ESSD
- å®‰å…¨ç»„: å¼€æ”¾ 22, 80, 443

#### 2. é…ç½® RDS

- æ•°æ®åº“ç±»å‹: MySQL 8.0
- è§„æ ¼: rds.mysql.t1.small
- å­˜å‚¨: 20GB

#### 3. é…ç½® OSSï¼ˆå¯é€‰ï¼‰

ç”¨äºå­˜å‚¨ç”¨æˆ·ä¸Šä¼ çš„æ–‡ä»¶å’Œå¤‡ä»½

---

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–

```sql
-- æ·»åŠ ç´¢å¼•
CREATE INDEX idx_conversations_user_updated ON conversations(user_id, updated_at);
CREATE INDEX idx_messages_conversation_created ON messages(conversation_id, created_at);
CREATE INDEX idx_token_usage_user_date ON token_usages(user_id, date);

-- ä¼˜åŒ–é…ç½® (my.cnf)
[mysqld]
innodb_buffer_pool_size = 2G
max_connections = 200
query_cache_size = 64M
```

### åç«¯ä¼˜åŒ–

```go
// åœ¨ database/db.go ä¸­ä¼˜åŒ–è¿æ¥æ± 
sqlDB.SetMaxIdleConns(25)
sqlDB.SetMaxOpenConns(100)
sqlDB.SetConnMaxLifetime(5 * time.Minute)
```

### å‰ç«¯ä¼˜åŒ–

```bash
# æ„å»ºä¼˜åŒ–
npm run build

# ä½¿ç”¨ CDN åŠ é€Ÿ
# é…ç½® nginx å¯ç”¨ gzip
gzip on;
gzip_types text/plain text/css application/json application/javascript;
```

### Redis ç¼“å­˜ï¼ˆå¯é€‰ï¼‰

```bash
# å®‰è£… Redis
sudo apt install redis-server

# é…ç½® Redis
sudo vim /etc/redis/redis.conf
# è®¾ç½®: maxmemory 512mb
# è®¾ç½®: maxmemory-policy allkeys-lru

# é‡å¯ Redis
sudo systemctl restart redis
```

---

## ç›‘æ§å’Œç»´æŠ¤

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo journalctl -u ai-chat-backend -f

# æŸ¥çœ‹ Nginx æ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log

# é…ç½®æ—¥å¿—è½®è½¬
sudo tee /etc/logrotate.d/ai-chat > /dev/null << 'EOF'
/var/log/ai-chat/*.log {
    daily
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 www-data www-data
    sharedscripts
}
EOF
```

### æ€§èƒ½ç›‘æ§

```bash
# å®‰è£…ç›‘æ§å·¥å…·
sudo apt install -y htop iotop nethogs

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ I/O
sudo iotop

# æŸ¥çœ‹ç½‘ç»œæµé‡
sudo nethogs
```

### å¥åº·æ£€æŸ¥è„šæœ¬

```bash
#!/bin/bash
# /usr/local/bin/health-check.sh

# æ£€æŸ¥åç«¯æœåŠ¡
if ! curl -f http://localhost:8080/health > /dev/null 2>&1; then
    echo "Backend is down, restarting..."
    sudo systemctl restart ai-chat-backend
    # å‘é€å‘Šè­¦é‚®ä»¶æˆ–é€šçŸ¥
fi

# æ£€æŸ¥ MySQL
if ! mysqladmin ping -h localhost -u root -p'password' > /dev/null 2>&1; then
    echo "MySQL is down!"
    # å‘é€å‘Šè­¦
fi

# æ£€æŸ¥ç£ç›˜ç©ºé—´
DISK_USAGE=$(df -h / | awk 'NR==2 {print $5}' | sed 's/%//')
if [ $DISK_USAGE -gt 80 ]; then
    echo "Disk usage is above 80%: ${DISK_USAGE}%"
    # å‘é€å‘Šè­¦
fi
```

### å®šæ—¶ä»»åŠ¡

```bash
# ç¼–è¾‘ crontab
crontab -e

# æ·»åŠ ä»¥ä¸‹ä»»åŠ¡
# æ¯5åˆ†é’Ÿæ£€æŸ¥å¥åº·çŠ¶æ€
*/5 * * * * /usr/local/bin/health-check.sh

# æ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½
0 2 * * * /usr/local/bin/backup-ai-chat.sh

# æ¯å‘¨æ—¥å‡Œæ™¨3ç‚¹æ¸…ç†æ—§æ—¥å¿—
0 3 * * 0 find /var/log/ai-chat -name "*.log" -mtime +30 -delete
```

---

## æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜

#### 1. åç«¯æ— æ³•å¯åŠ¨

```bash
# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u ai-chat-backend -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
sudo lsof -i :8080

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /var/www/ai-chat/backend/.env
```

#### 2. æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•è¿æ¥
mysql -h localhost -u ai_chat_user -p ai_chat

# æ£€æŸ¥ MySQL çŠ¶æ€
sudo systemctl status mysql

# æŸ¥çœ‹ MySQL æ—¥å¿—
sudo tail -f /var/log/mysql/error.log
```

#### 3. Nginx é…ç½®é”™è¯¯

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡æ–°åŠ è½½é…ç½®
sudo systemctl reload nginx

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

#### 4. ç£ç›˜ç©ºé—´ä¸è¶³

```bash
# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥æ‰¾å¤§æ–‡ä»¶
sudo du -sh /* | sort -rh | head -10

# æ¸…ç†æ—¥å¿—
sudo journalctl --vacuum-time=7d
```

---

## å®‰å…¨åŠ å›º

### 1. é˜²ç«å¢™é…ç½®

```bash
# åªå…è®¸å¿…è¦ç«¯å£
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22/tcp
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable
```

### 2. SSH å®‰å…¨

```bash
# ç¦ç”¨å¯†ç ç™»å½•
sudo vim /etc/ssh/sshd_config
# è®¾ç½®: PasswordAuthentication no
# è®¾ç½®: PermitRootLogin no

sudo systemctl restart sshd
```

### 3. å®šæœŸæ›´æ–°

```bash
# è‡ªåŠ¨å®‰å…¨æ›´æ–°
sudo apt install unattended-upgrades
sudo dpkg-reconfigure -plow unattended-upgrades
```

---

## æ‰©å±•å’Œå‡çº§

### æ°´å¹³æ‰©å±•

1. ä½¿ç”¨è´Ÿè½½å‡è¡¡å™¨ï¼ˆNginx/HAProxyï¼‰
2. éƒ¨ç½²å¤šä¸ªåç«¯å®ä¾‹
3. ä½¿ç”¨ Redis å…±äº«ä¼šè¯
4. æ•°æ®åº“è¯»å†™åˆ†ç¦»

### å‚ç›´æ‰©å±•

1. å‡çº§æœåŠ¡å™¨é…ç½®
2. ä¼˜åŒ–æ•°æ®åº“æ€§èƒ½
3. å¢åŠ ç¼“å­˜å±‚
4. ä½¿ç”¨ CDN

---

**éƒ¨ç½²å®Œæˆï¼ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸš€

